cmake_minimum_required( VERSION 2.4 )

if(COMMAND cmake_policy)
cmake_policy(SET CMP0003 NEW)
endif(COMMAND cmake_policy)

if (BUILD_TESTING)
	# -----------------------------------------------
	# CppUnit test framework: Create executable testCX
	#
	include_directories(
                ${CustusX3_SOURCE_DIR}/source/resource/OpenIGTLinkUtilities
                ${CustusX3_SOURCE_DIR}/source/resource/videoServer
		)

	# List of all test units
        cx_add_class_qt_moc( CX_TEST_SOURCE_FILES
		cxTestSenderController.h
		)

        cx_add_class(CX_TEST_SOURCE_FILES
                cxTestGEInterface
                cxTestSenderController
                cxtestCatchGEInterface.cpp
		${CX_TEST_SOURCE_FILES}
		)

	include(cxTestMacros)
	# define cppunit tests and ctest tests from same source:
#	SSC_ADD_CTEST_CPPUNIT_TESTS(cxTestGEInterface
#	    cxCppUnitMain.cpp
#	    "${CX_TEST_SOURCE_FILES}"
#	    cxGrabber)

        cx_catch_add_lib_and_exe(cxGrabber "${CX_TEST_SOURCE_FILES}")
   
if(CX_USE_ISB_GE)
	# Add the tests from the GEStreamer lib
	# TODO: Do this in a more elegant way
	# The second call to SSC_ADD_CTEST_CPPUNIT_TESTS overwrites the directory properties
	# set in CISST_ADD_TESTS. To overcome this I have created the CX_CISST_ADD_ADDITIONAL_TESTS
	# macro that appends the tests from one cppunit executable to the dart file of another
        set(GEStreamer_TEST_SOURCE_FILES
		${GEStreamer_SOURCE_DIR}/Testing/TestGEInterface.h
		${GEStreamer_SOURCE_DIR}/Testing/TestGEInterface.cpp
		)
	SSC_ADD_CTEST_CPPUNIT_TESTS(TestGEInterface 
	    "${GEStreamer_SOURCE_DIR}/Testing/CppUnitMain.cpp"
	    "${GEStreamer_TEST_SOURCE_FILES}" 
	    "${GEStreamer_LIBRARIES}")
endif()

# Add additional tests to dart test file
# Based loosely on CISST_ADD_TESTS macro
#
# Input:
#   testProgram:  Name of cppunit executable
#   dartTestFile: Name of cppunit executable that existing dart test is made from
macro(CX_CISST_ADD_ADDITIONAL_TESTS testProgram dartTestFile)
    ADD_CUSTOM_COMMAND(TARGET ${dartTestFile}
                     POST_BUILD
                     COMMAND ${testProgram}
                     ARGS -d >> DartTestfile-${dartTestFile}.txt
                     COMMENT "Adding tests to DartTestfile-${dartTestFile}.txt")
endmacro(CX_CISST_ADD_ADDITIONAL_TESTS)

	# Input names are generated by the SSC_ADD_CTEST_CPPUNIT_TESTS macro
#	CX_CISST_ADD_ADDITIONAL_TESTS(
#	    cxTestGEInterface_CppUnit_CTest
#	    TestGEInterface_CppUnit_CTest)

endif (BUILD_TESTING)
